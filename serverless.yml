service: ${file(./config.${self:custom.currentStage}.json):SERVICE}
useDotenv: true

provider:
  lambdaHashingVersion: 20201221
  name: aws
  runtime: nodejs10.x
  stage: dev
  region: eu-west-1
  apiGateway:
    shouldStartNameWithService: true

functions:
  server:
    handler: index.server
    environment:
      STAGE: ${self:custom.currentStage}
    events:
      - http: ANY /
      - http: ANY /{proxy+}

custom:
  currentStage: ${opt:stage, self:provider.stage}
  apigwBinary:
    types:
      - "*/*"

plugins:
  - serverless-apigw-binary
  - serverless-offline

package:
  exclude:
    - pages/**
    - components/**
    - src/**
    - utils/**
    - out/**
    - .next/cache/**
